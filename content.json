{"meta":{"title":"程序猿小站","subtitle":null,"description":null,"author":"橘子","url":"http://yoursite.com"},"pages":[{"title":"categories","date":"2018-11-21T09:59:19.000Z","updated":"2018-11-21T09:59:57.668Z","comments":false,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2018-11-21T09:59:22.000Z","updated":"2018-11-21T09:59:43.575Z","comments":false,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"Elasticsearch-6.2.4源码启动（window环境下）","slug":"Elasticsearch-6.2.4源码启动（window环境下）","date":"2018-11-22T02:13:44.333Z","updated":"2018-11-22T02:20:30.966Z","comments":true,"path":"2018/11/22/Elasticsearch-6.2.4源码启动（window环境下）/","link":"","permalink":"http://yoursite.com/2018/11/22/Elasticsearch-6.2.4源码启动（window环境下）/","excerpt":"","text":"Elasticsearch-6.2.4源码启动（window环境下）1. 获取源码和可运行的es1.1 首先从github上把es的源码拉下来并切换分支到v6.2.4版本（ps：es不同版本源码启动过程差异可能较大）。 1git clone https://github.com/elastic/elasticsearch.git 1git checkout v6.2.4 （本篇博客命令执行皆使用git bash） 1.2 到官网下载可运行的es 2. 编译源码es是一个gradle项目，导入idea前需执行gradle idea命令，不然会报错。 使用项目自带的gradlew编译es源码 ./gradlew idea ./gradlew build （IDE是eclipse的话则将命令中idea替换成eclipse） 编译完成后便可用idea打开项目。 3. 运行es如何从源码运行es？ 我们先参考官网下载的es中，bin目录下的启动脚本elasticsearch，elasticsearch-env 123456789101112(只列出关键部分，其余省略)SCRIPT=&quot;$0&quot;ES_HOME=`dirname &quot;$SCRIPT&quot;`ES_PATH_CONF=&quot;$ES_HOME&quot;/config......&quot;$JAVA&quot; \\$ES_JAVA_OPTS \\-Des.path.home=&quot;$ES_HOME&quot; \\-Des.path.conf=&quot;$ES_PATH_CONF&quot; \\-cp &quot;$ES_CLASSPATH&quot; \\org.elasticsearch.bootstrap.Elasticsearch \\...... 可见，es的启动入口为org.elasticsearch.bootstrap.Elasticsearch； es启动需要配置两个启动参数es.path.home和es.path.conf 其中es.path.home是es服务的路径，即es项目中server目录下，es.path.conf为配置文件目录，在server目录下创建config文件夹作为配置文件目录，并直接从官网的es中copy三个配置文件（此处不详解文件具体内容）。 打开idea配置两个启动参数（直接绝对路径即可） 12-Des.path.conf=E:\\......\\elasticsearch\\server\\config-Des.path.home=E:\\......\\elasticsearch\\server 在idea顶层菜单打开Run&gt;Edit Configurations，配置VM options 接下来我们启动试一试：src&gt;main&gt;java&gt;org&gt;elasticsearch&gt;bootstrap&gt;Elasticsearch 直接执行main方法，发现启动失败，出现几个异常： 第一个 原因是es启动时会去扫描主目录下的plugins目录，加载es插件（插件方面将在其他文章说明），所以要创建plugins目录。 第二个 原因是用户没有操作目录的权限 直接在server目录下建立java.policy文件： 123456789grant codeBase &quot;file:$&#123;&#123;java.ext.dirs&#125;&#125;/*&quot; &#123; permission java.security.AllPermission; permission java.lang.RuntimePermission &quot;createClassLoader&quot;;&#125;;grant &#123; permission java.security.AllPermission; permission java.lang.RuntimePermission &quot;createClassLoader&quot;;&#125;; VM options的配置增加： 123-Des.path.conf=E:\\......\\elasticsearch\\server\\config-Des.path.home=E:\\......\\elasticsearch\\server-Djava.security.policy=E:\\......\\elasticsearch\\server\\java.policy 第三个 原因是相关模块的缺失，es加载为空，直接把官网的es中的modules文件夹整个复制到server目录下就行。 第四个 ExtendedPluginsClassLoader这个类并没有编译出来 至于原因，我们可以在单元测试类BootstrapForTesting中看到这一段： 原来eclipse和idea并不会打包内置的依赖，即传递依赖： 可以看到plugin-classloader的编译类型是compileOnly和testRuntime，只在编译阶段编译，在运行阶段不会将这个依赖包括进来，idea是默认不会运行时不包括传递依赖的，可以在这里勾选设置启动将包括该类传递依赖 所有问题解决后便可以顺利启动了。","categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://yoursite.com/categories/Elasticsearch/"}],"tags":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://yoursite.com/tags/Elasticsearch/"}]},{"title":"Hello World","slug":"hello-world2","date":"2018-11-21T09:57:59.670Z","updated":"2018-11-21T09:58:11.740Z","comments":true,"path":"2018/11/21/hello-world2/","link":"","permalink":"http://yoursite.com/2018/11/21/hello-world2/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[{"name":"test1","slug":"test1","permalink":"http://yoursite.com/categories/test1/"}],"tags":[{"name":"test1","slug":"test1","permalink":"http://yoursite.com/tags/test1/"}]},{"title":"Hello World","slug":"hello-world","date":"2018-11-19T09:06:16.705Z","updated":"2018-11-22T02:13:52.833Z","comments":true,"path":"2018/11/19/hello-world/","link":"","permalink":"http://yoursite.com/2018/11/19/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[{"name":"test2","slug":"test2","permalink":"http://yoursite.com/categories/test2/"}],"tags":[{"name":"test2","slug":"test2","permalink":"http://yoursite.com/tags/test2/"}]}]}